告警及消警
============

    控制器实时读取各子设备数据后，经判断如发生了特定事件，将事件及伴随的数据发送至平台，告知用户设备中某些状态和数据超出范围，以引起用户的关注和采取响应的处理措施。
    
    按照以下列表分类:
        * `环境异常`_ 
        * `电力安全`_
        * `故障异常`_

环境异常
------------

    [环境异常] 未分类
        **光线异常无人**

        #. 当采集到的光线值处于 [ **光线异常光线阈值（区间开始值）** , **光线异常光线阈值(区间结束值)** ] 范围。
        #. 持续时长 >= **光线异常无人时间阈值** 。
        #. 当1、2同时满足，判定为光线异常无人. 触发告警。
        
        * 消警规则

        **光线异常有人**
        
        #. 当采集到的光线值处于 [ **人体感应光线阈值(区间开始值)** ,  无穷大 ] 范围且
        #. 持续时长 >= **人体感应有人时间阈值**, 
        #. 判定为光线异常有人， 触发告警。
            
        * 消警规则

    [环境异常] 一类
        #. 连续人员进入
            当 “人员进入” 触发后，且持续足够时长(告警状态->连续有人进入 中设定，缺省0)后， 触发告警。
            
            * 消警规则:

        #. 连续高温
            * 告警
            #. 当采集温度高于或等于 *高温报警温度* 设定的温度值。
            #. 1成立后的持续时长大于或等于 *告警状态->连续高温* 设定的时间长度。
            #. 当1和2成立后，控制器将上传[连续高温告警]至平台。

            * 消警规则
            #. 当采集温度低于 *高温报警温度* 设定的温度值。
            #. 1所呈现的状态，持续15s。
            #. 当1和2成立后，控制器将上报[连续高温告警-消警]至平台。

    [环境异常] 二类
        #. 人员进入
            #. 人体感应开关开启状态, 人体传感器触发，持续时长>=6秒。
            #. 当光线值在 [**人体感应光线阈值(区间开始值）**, **人体感应光线阈值(区间结束值)**] 范围。
            #. 当2中的光线值范围有效时(二者不全为0)， 1与2同时满足，判定为人员进入，触发告警。
            #. 当2中的光线值范围无效时(二者==0)， 1满足后，即判定为人员进入，触发告警。

            * 消警规则:
        
        #. 高温告警
            * 告警
            #. 当采集温度高于或等于 *高温报警温度* 设定的温度值。
            #. 1成立后的持续时长大于或等于 *高温报警时间(分)* 设定时间。
            #. 当1和2成立后，控制器将上报[高温告警]至平台。

            * 消警规则
            #. 当采集温度低于 *高温报警温度* 设定温度值。
            #. 1所呈现的状态，持续15s。
            #. 当1和2成立后，控制器将上报[高温告警-消警]至平台。
        
        #. 高温预警
            * 告警
            #. 当采集温度高于或等于 *预高温报警温度* 设定值。
            #. 1成立后的持续时长大于或等于 *预高温报警时间(分)* 设定值。
            #. 当1和2成立后，控制器将上报[高温预警]至平台。

            * 消警规则
            #. 当采集温度低于 *预高温报警温度* 设定温度值。
            #. 1所呈现的状态，持续15s。
            #. 当1和2成立后，控制器将上报[高温预警-消警]至平台。

        #. 连续运行
            * 告警
            #. 节能模式开启
            #. 空调机开机状态持续时长大于或等于 *告警状态->连续开机* 设定的时长。
            #. 当1和2同时满足后，将上报[连续运行]告警至平台。

            * 消警: 
            #. 分闸
            #. 空调关机
            #. 节能模式关闭
            #. 当以上三个条件，有任意一个成立，控制器将发出[连续运行-消警]至平台。
            
        #. 连续停机
            * 告警
            #. 节能模式开启
            #. 空调机停机状态持续时长大于或等于 *告警状态->连续停机* 设定的时长。
            #. 当1和2同时满足后，将上报[连续停机]告警至平台。

            * 消警: 
            #. 空调开机
            #. 节能模式关闭
            #. 当以上两个条件，有任意一个成立，控制器将发出[连续运行-消警]至平台。

电力安全
------------

    [电力安全] 一类
        #. 空调异常断电
            * 告警    
            #. 采集器出线，所有的线路全部断开
            #. 1中状态持续1分钟周，上报[空调异常断电-告警]至平台。

            * 消警
            #. 采集器出线，当零线+任意1相火线线路连通
            #. 1所属状态持续1分钟周，上报[空调异常断电-消警]至平台。

    [电力安全] 二类
        #. 过压
            * 告警   
            #. 采集器进线中，任意一相电压高于272v （状态持续3秒后，采集器将执行分闸动作）
            #. 1所示状态持续2秒后，上报[过压-告警]至平台。

            * 消警
            #. 采集器进线中，所有相电压处于区间[195v, 253v], （状态持续10分钟后，采集器将执行合闸动作）
            #. 1所示状态持续15秒后，上报[过压-消警]至平台。
        
        #. 欠压
            * 告警    
            #. 采集器进线中，任意一相电压低于177v （状态持续3秒后，采集器将执行分闸动作）
            #. 1所示状态持续2秒后，上报[欠压-告警]至平台。

            * 消警
            #. 采集器进线中，所有相电压处于区间[195v, 253v] （状态持续10分钟后，采集器将执行合闸动作）
            #. 1所示状态持续15后，上报[欠压-消警]至平台。
        
        #. 过流
            * 告警
            #. 采集器出线中，任意一相电流高于32A （状态持续30秒后，采集器将执行分闸动作）
            #. 1所示状态持续2秒后，上报[过流-告警]至平台。

            * 消警
            #. 采集器出线所有相电流低于32A，所示状态持续15后，上报[过流-消警]至平台。
        
        #. 漏电
            * 告警
            #. 采集器出线任意一相出现漏电，且漏电电流>=25mA， 上报[漏电-告警]至平台。

            * 消警
            #. 采集器出线所有相出线的漏电值 < 25mA，上报[漏电-消警]至平台。
        
        #. 故障电弧 (无) 
        
        #. 供电异常
            *供电异常，单指采集器的进电断电的情况*
            
            * 告警 
            #. 2P 采集器进电电压低于60v，判定为进电异常.
            #. 3P 采集器3相进电电压全部低于60v，判定为进电异常.
            #. 以上两个条件，任意条件成立，即上报[空调异常断电-告警]至平台。

            * 消警
            #. 恢复供电1分钟后，判定为消警，发送[空调异常断电-消警]到平台。
        
        #. 异常波形 (无)
    
    [电力安全] 三类
        #. 过温
            * 告警
            #. 采集器出线端子温度高于75℃, 状态持续2秒钟，发送[过温-告警]。 高于85℃且持续X分钟后，采集器执行分闸，以保护负载。
            #. 过温导致的分闸，不会自动合闸。

            * 消警
            #. 采集器出线端子温度低于75℃, 状态持续X秒钟，发送[过温-消警] *(X=温度高于75℃后，共计持续了多少秒钟 )*
        
        #. 三相不平衡 (无)

故障异常
------------

    [故障异常] 一类
        #. 制冷不足 （无）
            采集器与空调机连接示意
            采集器  --------- *控制指令* -------> 空调机
            采集器  <------ *读取回风温度* -----  空调机
            采集器发送 **开机运行** 指令到空调机，随后通过 **回风温度传感器** 判断制冷是否生效。当回风温度
            * 告警: 采集器读取回风温度数值，判断温度下降的速度异常，累计3次降温速度异常， 认定为 **制冷不足**。
            * 消警: 采集器读取回风温度数值，判断温度已达到预期或者温降达到预期，即发送 **制冷不足消警** 至平台平台。
            * **上述告警、消警 触发条件缺少数据实现量化**

    [故障异常] 二类
        #. 空调故障
            * 告警: 
            #. 仅节能模式开启时有效
            #. 节能模式开启时，控制器发送开机/关机指令，如控制失败每间隔 *空调关机等待时间调节* 时间，再次发送开/关机指令。
            #. 1中操作次数达到6次及以上，均未执行成功（即 空调机未能开机/关机）。
            #. 1和2同时满足时，将上报[空调故障-告警]至平台。

            * 消警: 
            #. 当开/关机指令将会持续发送，间隔 *空调关机等待时间调节* 设定的时间。
            #. 当指令发送后，空调机执行了开机/关机， 上报[空调故障-消警]至平台。
        
        #. 异常停止 (放置， 考虑逻辑上可能与空调故障告警重复)
            节能模式 [#节能模式]_ 开启状态，当空调在运行过程（此过程为采集器内的预期过程）周期读取空调机的功率值大小。当空调机的功率值过小时，认定 **空调机异常停止**
            * 告警: 
            #. 当 **异常停止告警** 产生后，即刻上报至平台。
            
            * 消警: 当检测空调机功率值达到预期后，发送消警到平台。
            
            * 空调机功率值过小，持续多长时间???

        #. 热保故障 (无)
        
        #. 子设备通讯故障 (待议)
            * 告警
            #. 控制器读取读取子设备数据，判定为无效数据
            #. 1所示状态持续 秒后
            #. 1和2同时满足时，上报[子设备通讯故障-告警]
    
            * 消警

    [故障异常] 三类
        #. 离线 （废弃）

